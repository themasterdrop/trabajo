
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Distribución de Días de Espera y Especialidades</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }
    #histograma, #piechart {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>
  <h2>Distribución de Días de Espera</h2>
  <div id="histograma"></div>

  <h2>Distribución por Especialidad</h2>
  <div id="piechart"></div>

  <script>
    fetch('datos.json')
      .then(response => response.json())
      .then(data => {
        const dias = data.map(d => d.DIFERENCIA_DIAS);

        // Crear histograma con rangos de 10 días
        const histData = [{
          x: dias,
          type: 'histogram',
          xbins: {
            size: 10
          },
          marker: { color: '#1f77b4' }
        }];

        const histLayout = {
          title: 'Días de Espera',
          xaxis: { title: 'Días' },
          yaxis: { title: 'Frecuencia' }
        };

        Plotly.newPlot('histograma', histData, histLayout);

        // Función para actualizar el gráfico de pastel
        function actualizarPieChart(diaSeleccionado) {
          const filtrados = data.filter(d => d.DIFERENCIA_DIAS >= diaSeleccionado && d.DIFERENCIA_DIAS < diaSeleccionado + 10);
          const conteo = {};
          filtrados.forEach(d => {
            conteo[d.ESPECIALIDAD] = (conteo[d.ESPECIALIDAD] || 0) + 1;
          });

          const especialidadesOrdenadas = Object.keys(conteo).sort((a, b) => conteo[b] - conteo[a]);
          const labels = especialidadesOrdenadas.slice(0, 5);
          const values = labels.map(label => conteo[label]);

          // Agrupar el resto de especialidades en 'Otras'
          const otrasEspecialidades = especialidadesOrdenadas.slice(5);
          const otrasCount = otrasEspecialidades.reduce((acc, label) => acc + conteo[label], 0);
          if (otrasCount > 0) {
            labels.push('Otras');
            values.push(otrasCount);
          }

          const pieData = [{
            labels: labels,
            values: values,
            type: 'pie'
          }];

          const pieLayout = {
            title: `Especialidades para ${diaSeleccionado}-${diaSeleccionado + 9} días de espera`
          };

          Plotly.newPlot('piechart', pieData, pieLayout);
        }

        // Mostrar gráfico de pastel inicial con el rango más frecuente
        const diaMasFrecuente = dias.sort((a,b) =>
          dias.filter(v => v >= a && v < a + 10).length - dias.filter(v => v >= b && v < b + 10).length
        ).pop();
        actualizarPieChart(diaMasFrecuente);

        // Evento de clic en el histograma
        document.getElementById('histograma').on('plotly_click', function(event) {
          const diaSeleccionado = Math.floor(event.points[0].x / 10) * 10;
          actualizarPieChart(diaSeleccionado);
        });
      });
  </script>
</body>
</html>
